


<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="В последнее время в экосистеме Python часто стали появляться инструменты для управления зависимостями. Оно понятно, стандартный pip уже не отвечает современным требованиям: неудобная работа с завис..." />
    <meta name="google-site-verification" content="2oW122oyzuORLWrpVhZ29-2w0dTvpjiEL922qCuSa5M" />
    <title>Poetry: новый менеджер зависимостей в Python</title>
    <link rel="stylesheet" href="/static/css/normalize.css">
    <link rel="stylesheet" href="/static/css/bootstrap.min.css">
    <link rel="stylesheet" href="/static/css/bootstrap-theme.min.css">
    <link rel="stylesheet" href="/static/css/style.css?28022018">
    <link rel="stylesheet" href="/static/font-awesome/css/font-awesome.min.css">
    <link rel='dns-prefetch' href='//cdnjs.cloudflare.com' />
    <link rel='dns-prefetch' href='//unpkg.com' />
    <link href="/static/images/icon.png" rel="shortcut icon" type="image/x-icon" />


    


    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.0.0/styles/monokai-sublime.min.css">
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.10.0/highlight.min.js"></script>


    <script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
    <script src="/static/js/bootstrap.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>


    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-72123410-1', 'auto');
      ga('send', 'pageview');

    </script>
    <!-- Yandex.Metrika counter -->
    <script type="text/javascript">
        (function (d, w, c) {
            (w[c] = w[c] || []).push(function() {
                try {
                    w.yaCounter32700075 = new Ya.Metrika({
                        id:32700075,
                        clickmap:true,
                        trackLinks:true,
                        accurateTrackBounce:true
                    });
                } catch(e) { }
            });

            var n = d.getElementsByTagName("script")[0],
                s = d.createElement("script"),
                f = function () { n.parentNode.insertBefore(s, n); };
            s.type = "text/javascript";
            s.async = true;
            s.src = "https://mc.yandex.ru/metrika/watch.js";

            if (w.opera == "[object Opera]") {
                d.addEventListener("DOMContentLoaded", f, false);
            } else { f(); }
        })(document, window, "yandex_metrika_callbacks");
    </script>
    <noscript><div><img src="https://mc.yandex.ru/watch/32700075" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
    <!-- /Yandex.Metrika counter -->


</head>

<body>
    <div class="blog-masthead">
        <div class="container container-wrap">
            <div role="navigation">

            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#collapse-menu" aria-expanded="false">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
            </div>

            <div class="collapse navbar-collapse" id="collapse-menu" style="padding:0;">
                <ul class="menu__navigation">
                    <li><a class="blog-nav-item" href="/ru/">Блог</a></li>
                    <li><a class="blog-nav-item" href="/ru/archives/">Архивы</a></li>
                    <li><a class="blog-nav-item" href="/ru/p/contacts/">Контакты</a></li>
                    <li>
                        
                            <a class="blog-nav-item" href="/en/"><img src="/static/images/us-flag.png" alt="In English" title="English version"></a>
                        
                    </li>
                    
                </ul>
            </div>
        </div>
    </div>
    </div>

    
    <div class="container container-wrap">
        <div class="row">
            <div class="col-md-8">
                <article>
                    <h1>Poetry: новый менеджер зависимостей в Python</h1>

                    <div class="article-meta">
                        <span class="glyphicon glyphicon-calendar" aria-hidden="true"></span>
                        <span>13 Ноя. 2018</span>, <a
                            href="/ru/category/toolbox/">Инструменты</a>,
                        <span>1179 просмотров</span>
                        
                    </div>
                    <p>В последнее время в экосистеме Python часто стали появляться инструменты для управления зависимостями. Оно понятно, стандартный pip уже не отвечает современным требованиям: неудобная работа с зависимостями, много ручной работы при подготовке пакетов, проблемы при установке и обновлении и много чего другого.</p>
<p>С недавних пор я начал использовать новый менеджер под названием Poetry. Именно о нём сегодня пойдёт речь.</p>
<p>Функциональные возможности Poetry:</p>
<ul>
<li>Управление зависимостями через toml файл (прощай, requirements.txt)</li>
<li>Автоматическое создание изолированного виртуального окружения Python (теперь не нужно для этого вызывать virtualenv)</li>
<li>Удобное создание пакетов (отныне не нужно <del>копипастить</del> создавать setup.py каждый раз)</li>
<li>poetry.lock файл для фиксирования версий зависимостей</li>
</ul>
<p>А особенно радует тандем при работе с pyenv. О pyenv <a href="https://khashtamov.com/ru/pyenv-python/" target="_blank">я писал</a> три года назад.</p>
<!--more-->

<h2>Установка</h2>
<p>Исходный код проекта лежит на <a href="https://github.com/sdispater/poetry" target="_blank">github</a>. Для установки необходимо выполнить команду:</p>
<pre>
<code class="bash">curl -sSL https://raw.githubusercontent.com/sdispater/poetry/master/get-poetry.py | python</code></pre>
<p>Если установка прошла успешно, то убедиться в этом можно вызвав:</p>
<pre>
<code class="bash">$ poetry --version
Poetry 0.12.8</code></pre>
<h2>Стартуем!</h2>
<p>Создаём новый проект <em>my-demo-project</em>:</p>
<pre>
<code class="bash">$ poetry new my-demo-project</code></pre>
<p>Заходим в папку:</p>
<pre>
<code class="bash">$ cd my-demo-project/
~/my-demo-project$ ls
README.rst my_demo_project pyproject.toml tests</code></pre>
<p>Poetry автоматически создал все необходимые файлы для будущего пакета, но наибольший интерес представляет файл с названием <em>pyproject.toml</em>, этот файл можно рассматривать как продвинутую альтернативу старичку requirements.txt. Взглянем на содержимое:</p>
<pre>
<code class="bash">[tool.poetry]
name = "my-demo-project"
version = "0.1.0"
description = ""
authors = ["Your Name you@example.com"]

[tool.poetry.dependencies]
python = "^3.6"

[tool.poetry.dev-dependencies]
pytest = "^3.0"

[build-system]
requires = ["poetry&gt;=0.12"]
build-backend = "poetry.masonry.api"
</code></pre>
<p>Формат файла <a href="https://github.com/toml-lang/toml" target="_blank">TOML</a>. Раздел <em>tool.poetry</em> предназначен для описания проекта: название, версия, краткая информация о проекте и т.д. Далее следует <em>tool.poetry.dependencies</em>, именно здесь будут указаны все production зависимости. Их можно указать вручную (привет, requirements.txt), но мы так делать не будем (привет, npm!). Раздел <em>tool.poetry.dev-dependencies</em> предназначен для зависимостей во время разработки (привет, pytest, tox!)</p>
<h2>Добавляем зависимости</h2>
<p>Давайте добавим к проекту зависимость в виде Luigi.</p>
<pre>
<code class="bash">~/my-demo-project$ poetry add luigi==2.8.0

Creating virtualenv my-demo-project-py3.6 in /home/user/.cache/pypoetry/virtualenvs
Updating dependencies
Resolving dependencies... (24.1s)

Package operations: 12 installs, 0 updates, 0 removals

Writing lock file
  - Installing docutils (0.14)
  - Installing lockfile (0.12.2)
  - Installing six (1.11.0)
  - Installing atomicwrites (1.2.1)
  - Installing attrs (18.2.0)
  - Installing more-itertools (4.3.0)
  - Installing pluggy (0.8.0)
  - Installing py (1.7.0)
  - Installing python-daemon (2.1.2)
  - Installing tornado (4.5.3)
  - Installing luigi (2.8.0)
  - Installing pytest (3.10.1)
</code></pre>
<p>Обратите внимание, что Poetry автоматически создал виртуальное окружение через virtualenv при добавлении пакета (т.к. ранее оно не было создано). Все окружения находятся по пути <em>~/.cache/pypoetry/virtualenvs</em></p>
<p>Если снова открыть <em>pyproject.toml</em>, то можно увидеть новую запись в разделе зависимостей:</p>
<pre>
<code class="bash">[tool.poetry.dependencies]
python = "^3.6"
luigi = "=2.8.0"
</code></pre>
<p>Всю "грязную" работу за нас делает Poetry. Чтобы добавить зависимость для разработки достаточно указать флаг &mdash;dev:</p>
<pre>
<code class="bash">$ poetry add tox --dev

Using version ^3.5 for tox
Updating dependencies
Resolving dependencies... (6.3s)
Package operations: 4 installs, 0 updates, 0 removals

Writing lock file
  - Installing filelock (3.0.10)
  - Installing toml (0.10.0)
  - Installing virtualenv (16.1.0)
  - Installing tox (3.5.3)
</code></pre>
<p>Смотрим содержимое <em>pyproject.toml</em> ещё раз:</p>
<pre>
<code class="bash">[tool.poetry.dev-dependencies]
pytest = "^3.0"
tox = "^3.5"
</code></pre>
<p>Чтобы удалить зависимость нужно выполнить:</p>
<pre>
<code class="bash">~/my-demo-project$ poetry remove luigi</code></pre>
<h2>Сборка пакета</h2>
<p>Отныне забудьте про головную боль с ручным созданием <em>setup.py</em>, прописыванием туда всех зависимостей и запоминанием команд для сборки через pip. Всё стало в разы проще. Чтобы собрать python пакет выполните:</p>
<pre>
<code class="bash">~/my-demo-project$ poetry build

Building my-demo-project (0.1.0)
 - Building sdist
 - Built my-demo-project-0.1.0.tar.gz
 - Building wheel
 - Built my_demo_project-0.1.0-py3-none-any.whl
</code></pre>
<p>В папке <em>dist</em> будут сформированы пакеты. Чтобы поделиться своим творением с другими разработчиками, например через pypi, выполните:</p>
<pre>
<code class="bash">~/my-demo-project$ poetry publish</code></pre>
<h2>Окружение</h2>
<p>Для активации виртуального окружения необходимо выполнить команду:</p>
<pre>
<code class="bash">~/my-demo-project$ poetry shell</code></pre>
<h2>Вывод</h2>
<p>Проект Poetry появился 28 февраля 2018 года, последняя версия 0.12.8. Инструмент молодой, но перспективный и быстроразвивающийся. Уже сейчас он на голову выше старичка pip и по функциональным возможностям и по удобству использования. Советую вам его попробовать и поделиться мнением в комментариях к этой статье. За более подробной информацией об инструменте советую заглянуть на <a href="https://poetry.eustace.io/" target="_blank" rel="nofollow">сайт с документацией</a>.</p>
                </article>

                
                    <div class="row" style="margin-top: 20px;">
                        <div class="col-md-4">
                            <img src="/static/images/devbrain.png" alt="Telegram канал"
                                 title="Telegram канал">
                        </div>
                        <div class="col-md-8">
                            <div class="author-cloud" style="border: 1px #b9baba solid;">
                                <div class="tchannel-info">
                                    <p>
                                        Не так давно я открыл канал в Telegram на тему разработки программного обеспечения, называется он <strong>DevBrain</strong>. На канале я делюсь своими мыслями , а также ресурсами (статьями, видео, презентациями, книжными рекомендациями и т.д.) о кодинге, методологиях разработки и многом другом с чем нам, разработчикам, приходится сталкиваться каждый день в работе.
                                    </p>

                                    <p>
                                        На канале уже более 3000 участников, поэтому присоединяйтесь и Вы — <a href="tg://devbrain" target="_blank" rel="nofollow noindex">DevBrain</a>
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                
                <div id="disqus_thread" style="margin-top:15px;"></div>

                
                    <div class="row">
                        <div class="col-md-12">
                            <h2>Интересные записи:</h2>
                            <ul>
                                
                                    <li><a href="/ru/vagrant-how-to-setup/">Vagrant: что за зверь и как с ним работать?</a></li>
                                
                                    <li><a href="/ru/windows-10-ubuntu-upgrade/">Обновляем подсистему Linux на Windows 10</a></li>
                                
                                    <li><a href="/ru/windows-10-ubuntu-howto/">Windows 10 Ubuntu: запускаем Django приложение</a></li>
                                
                                    <li><a href="/ru/kvm-setup-server/">Используем KVM для создания виртуальных машин на сервере</a></li>
                                
                            </ul>
                        </div>
                    </div>
                
            </div>
            



<div class="col-md-4">

    <div class="sidebar-widget" style="margin-top:40px;">
        <h4 class="sidebar-title">Поиск</h4>
        <form action="/ru/search/" method="get" class="form-inline" onsubmit="yaCounter32700075.reachGoal('searchBtnClick'); return true;">
            <input style="width: 100%;border-radius:1px;" class="form-control" type="text" name="query"
                    placeholder="поиск">

            <button class="btn btn-primary btn-block"
                    style="margin-top:10px;border-radius:1px;">Найти</button>
        </form>
    </div>























































    <div class="sidebar-widget">
        <h4 class="sidebar-title">Свежие записи</h4>
        <ul style="padding:0; list-style: none;">
            
                <li><a href="/ru/postgresql-python-psycopg2/">Работа с PostgreSQL в Python</a></li>
            
                <li><a href="/ru/python-poetry-dependency-management/">Poetry: новый менеджер зависимостей в Python</a></li>
            
                <li><a href="/ru/telegram-auth-django/">Авторизация через Telegram в Django и Python</a></li>
            
                <li><a href="/ru/amazon-redshift-python/">Amazon Redshift и Python</a></li>
            
                <li><a href="/ru/remote-job-aggregator/">Агрегатор вакансий об удалённой работе</a></li>
            
                <li><a href="/ru/designing-data-intensive-applications/">Designing Data-Intensive Applications</a></li>
            
                <li><a href="/ru/machine-learning-big-data/">Машинное обучение и Big Data</a></li>
            
                <li><a href="/ru/data-pipeline-luigi-python/">Строим Data Pipeline на Python и Luigi</a></li>
            
                <li><a href="/ru/windows-10-ubuntu-upgrade/">Обновляем подсистему Linux на Windows 10</a></li>
            
                <li><a href="/ru/pandas-introduction/">Введение в pandas: анализ данных на Python</a></li>
            
        </ul>
    </div>
    
























    
    <div class="sidebar-widget">
        <h4 class="sidebar-title">Самые популярные</h4>
        <ul style="padding:0; list-style: none;">
            
                <li><a href="/ru/create-telegram-bot-in-python/">Как написать Telegram бота: практическое руководство</a></li>
            
                <li><a href="/ru/pandas-introduction/">Введение в pandas: анализ данных на Python</a></li>
            
                <li><a href="/ru/python-requests/">Руководство по работе с HTTP в Python. Библиотека requests</a></li>
            
                <li><a href="/ru/celery-best-practices/">Celery: начинаем правильно</a></li>
            
                <li><a href="/ru/free-ssl-certificates-lets-encrypt/">Бесплатные SSL сертификаты от Let&#39;s Encrypt</a></li>
            
                <li><a href="/ru/why-python/">Почему Python?</a></li>
            
                <li><a href="/ru/kvm-setup-server/">Используем KVM для создания виртуальных машин на сервере</a></li>
            
                <li><a href="/ru/vagrant-how-to-setup/">Vagrant: что за зверь и как с ним работать?</a></li>
            
                <li><a href="/ru/how-to-deploy-django-app/">Разворачиваем Django приложение в production на примере Telegram бота</a></li>
            
                <li><a href="/ru/django-channels-websocket/">Django Channels: работа с WebSocket и не только</a></li>
            
        </ul>
    </div>

</div>

        </div>

    <script>
    var disqus_config = function () {
    this.page.url = 'https://khashtamov.com/ru/python-poetry-dependency-management/';
    this.page.identifier = '/ru/python-poetry-dependency-management/-47';
    };
    (function() { // DON'T EDIT BELOW THIS LINE
    var d = document, s = d.createElement('script');
    s.src = 'https://khashtamov.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
    })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

    </div>



    <!--footer-->
    <div class="container container-wrap">
        <div class="row">
            <div class="col-md-12">
                <div class="footer" style="padding-bottom: 20px;padding-top:20px;">
                    <p><span style="font-size: .8em;color:#9b9b9b;">Работает на Django 2.1.2 & Python 3.6.1  @ <a href="https://goo.gl/Yp6mKz" rel="nofollow noindex" target="_blank">DigitalOcean</a> © 2015 — 2018</span></p>
                </div>
            </div>
        </div>
    </div>


</body>
</html>
